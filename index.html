<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Molecular Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-green-600 text-white py-4 shadow">
    <h1 class="text-2xl font-bold text-center">ðŸ§¬ Molecular Explorer</h1>
    <p class="text-center text-sm mt-1">Herramienta interactiva para anÃ¡lisis bÃ¡sico de secuencias de ADN</p>
  </header>

  <main class="max-w-5xl mx-auto p-6 space-y-8">
    <section class="bg-white p-5 rounded-2xl shadow">
      <h2 class="text-xl font-semibold mb-3">Ingresar secuencia de ADN</h2>
      <textarea id="dnaInput" rows="5" class="w-full p-2 border rounded" placeholder="Ejemplo: ATGGCTGCTTTTCTTCTTCTCTCTGTTGTTGCTGCT..."></textarea>
      <p class="text-sm text-gray-500 mt-1">Ingresa una secuencia de ADN (solo letras A, T, G, C).</p>
    </section>

    <!-- Opciones de anÃ¡lisis -->
    <section class="bg-white p-5 rounded-2xl shadow">
      <h2 class="text-xl font-semibold mb-4">Opciones de anÃ¡lisis</h2>

      <!-- Reverse complement -->
      <div class="mb-6">
        <button id="revCompBtn" class="px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded">Generar reverse complement</button>
        <button id="helpRevBtn" title="Ver imagen explicativa" class="px-2 py-1 ml-2 bg-gray-200 rounded">ðŸ“·</button>
        <div class="text-sm text-gray-600 mt-1">
          Crea la hebra complementaria y la invierte (Ãºtil para analizar la cadena opuesta del ADN).
        </div>
        <pre id="revOut" class="p-2 mt-2 bg-gray-50 border rounded overflow-auto max-h-32"></pre>
      </div>

      <!-- Contenido GC -->
      <div class="mb-6">
        <button id="gcBtn" class="px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded">Calcular GC%</button>
        <div class="text-sm text-gray-600 mt-1">Calcula el porcentaje de Guanina (G) y Citosina (C) en la secuencia.</div>
        <div id="gcOut" class="mt-2 font-mono text-blue-700"></div>
      </div>

      <!-- TraducciÃ³n -->
      <div>
        <button id="translateBtn" class="px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded">Traducir (proteÃ­na)</button>
        <div class="text-sm text-gray-600 mt-1">
          Traduce el ADN a proteÃ­na en los tres marcos de lectura. Usa la opciÃ³n para detener en el primer codÃ³n STOP.
        </div>

        <div class="mt-2 flex items-center gap-3">
          <input id="untilStopChk" type="checkbox">
          <label for="untilStopChk" class="text-sm">Traducir hasta primer STOP (ORF)</label>
          <select id="stopSymbolSelect" class="p-1 border rounded text-sm">
            <option value="*">Mostrar '*'</option>
            <option value="[STOP]">Mostrar '[STOP]'</option>
            <option value="">Ocultar STOP</option>
          </select>
        </div>

        <div class="mt-3 grid md:grid-cols-3 gap-3">
          <div>
            <div class="text-xs text-gray-500">Frame 1 (offset 0)</div>
            <pre id="transOut1" class="p-2 bg-gray-50 border rounded overflow-auto max-h-32">â€”</pre>
          </div>
          <div>
            <div class="text-xs text-gray-500">Frame 2 (offset 1)</div>
            <pre id="transOut2" class="p-2 bg-gray-50 border rounded overflow-auto max-h-32">â€”</pre>
          </div>
          <div>
            <div class="text-xs text-gray-500">Frame 3 (offset 2)</div>
            <pre id="transOut3" class="p-2 bg-gray-50 border rounded overflow-auto max-h-32">â€”</pre>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal explicativo reverse complement -->
  <div id="modalRev" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
    <div class="bg-white p-4 rounded-xl max-w-3xl w-full">
      <div class="flex justify-between items-center">
        <h3 class="font-semibold text-lg">Reverse complement â€” explicaciÃ³n</h3>
        <button id="closeModalRev" class="text-red-600 font-bold">âœ–</button>
      </div>
      <img src="assets/images/reverse_complement.png" alt="Reverse complement" class="mt-4 rounded border w-full" />
      <p class="text-sm text-gray-600 mt-2">La cadena complementaria se forma cambiando Aâ†”T y Gâ†”C, luego se invierte la direcciÃ³n (5'â†’3').</p>
    </div>
  </div>

  <footer class="text-center text-gray-600 text-sm mt-10 mb-4">
    Â© 2025 Molecular Explorer â€” Desarrollado por Carlos Flores
  </footer>

  <script>
    const dnaInput = document.getElementById('dnaInput');
    const revOut = document.getElementById('revOut');
    const gcOut = document.getElementById('gcOut');
    const transOut1 = document.getElementById('transOut1');
    const transOut2 = document.getElementById('transOut2');
    const transOut3 = document.getElementById('transOut3');
    const untilStopChk = document.getElementById('untilStopChk');
    const stopSymbolSelect = document.getElementById('stopSymbolSelect');

    // --- FunciÃ³n para limpiar secuencia ---
    const cleanSeq = s => s.toUpperCase().replace(/[^ATGCUN]/g, '').replace(/U/g, 'T');

    // --- Reverse Complement ---
    document.getElementById('revCompBtn').addEventListener('click', () => {
      const seq = cleanSeq(dnaInput.value);
      const comp = seq.split('').map(b => ({A:'T',T:'A',G:'C',C:'G'})[b] || '').reverse().join('');
      revOut.textContent = comp || 'â€”';
    });

    // --- GC Content ---
    document.getElementById('gcBtn').addEventListener('click', () => {
      const seq = cleanSeq(dnaInput.value);
      const gc = (seq.match(/[GC]/g) || []).length;
      const percent = seq.length ? ((gc / seq.length) * 100).toFixed(2) : 0;
      gcOut.textContent = `Contenido GC: ${percent}%`;
    });

    // --- Codon map ---
    const codonMap = {
      'TTT':'F','TTC':'F','TTA':'L','TTG':'L','CTT':'L','CTC':'L','CTA':'L','CTG':'L',
      'ATT':'I','ATC':'I','ATA':'I','ATG':'M','GTT':'V','GTC':'V','GTA':'V','GTG':'V',
      'TCT':'S','TCC':'S','TCA':'S','TCG':'S','CCT':'P','CCC':'P','CCA':'P','CCG':'P',
      'ACT':'T','ACC':'T','ACA':'T','ACG':'T','GCT':'A','GCC':'A','GCA':'A','GCG':'A',
      'TAT':'Y','TAC':'Y','TAA':'*','TAG':'*','CAT':'H','CAC':'H','CAA':'Q','CAG':'Q',
      'AAT':'N','AAC':'N','AAA':'K','AAG':'K','GAT':'D','GAC':'D','GAA':'E','GAG':'E',
      'TGT':'C','TGC':'C','TGA':'*','TGG':'W','CGT':'R','CGC':'R','CGA':'R','CGG':'R',
      'AGT':'S','AGC':'S','AGA':'R','AGG':'R','GGT':'G','GGC':'G','GGA':'G','GGG':'G'
    };

    function translateFrame(seq, frame=0, options={untilStop:false, stopSymbol:'*'}) {
      const s = cleanSeq(seq).slice(frame);
      let aa = '';
      for (let i=0; i+2 < s.length; i+=3) {
        const cod = s.slice(i,i+3);
        const mer = codonMap[cod] || 'X';
        if (mer === '*') {
          if (options.untilStop) return aa;
          aa += (options.stopSymbol === '' ? '' : options.stopSymbol);
        } else {
          aa += mer;
        }
      }
      return aa;
    }

    function translateAllFrames(seq, options={untilStop:false, stopSymbol:'*'}) {
      return [
        translateFrame(seq, 0, options),
        translateFrame(seq, 1, options),
        translateFrame(seq, 2, options)
      ];
    }

    function updateTranslations() {
      const seq = dnaInput.value;
      const opts = { untilStop: untilStopChk.checked, stopSymbol: stopSymbolSelect.value };
      const [f1,f2,f3] = translateAllFrames(seq, opts);
      transOut1.textContent = f1 || 'â€”';
      transOut2.textContent = f2 || 'â€”';
      transOut3.textContent = f3 || 'â€”';
    }

    document.getElementById('translateBtn').addEventListener('click', updateTranslations);
    untilStopChk.addEventListener('change', updateTranslations);
    stopSymbolSelect.addEventListener('change', updateTranslations);

    // --- Modal ---
    document.getElementById('helpRevBtn').addEventListener('click', () => {
      const modal = document.getElementById('modalRev');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    });
    document.getElementById('closeModalRev').addEventListener('click', () => {
      const modal = document.getElementById('modalRev');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    });
  </script>
</body>
</html>
